# Irine_mqtt_plugin

## Плагин позволяющий управлять умными устройствами по mqtt

На Данный момент реализованы функции управления устройствами на прошивке [Tasmota][link1].


## Команды
Для управления используются фразы с любыми (не чувствителен к склонениям) словами.
Ограничение только на первые два слова - имя ассистента и триггер действия.

### Примеры команд:

- "_Ирина сделай ночник на кухне красным_" то-же самое, что "_Ирина сделай красный цвет ночника на кухне_"
- "_Ирина включи лампу на кухне_" то же самое, что "_Ирина включи пожалуйста лампу на моей кухне_"
- "_Ирина выключи ночник в гостиной_" **не то-же самое, что** "_Ирина выключи ночник_"

**Важное уточнение**: Для одноименных устройств "_лампа в гостиной_" и просто "_лампа_", устройство без уточнения местоположения следует указывать в последнюю очередь. 
Подробнее в разделе **Файл с действиями/устройствами**.

## Файл с действиями/устройствами

Файл в формате _.json_ содержит список действий. В каждом действии нужно прописать устройства к которым применимо действие, а так-же параметры для уточнения действия если они требуются.

Небольшое описание файла устройств/действий. Рассмотрим в общем виде одно действие.
```json
{
  "action": "mqtt",
  "command": "включить",
  "items": [...]
  "parameters": [...]
}
```
Каждое действие обязательно содержит **command** - один глагол, желательно отвечающий на вопрос _"Что сделать?"_

```json
"items": [
  {
    "word": "окно",
    "addition": "в гостиной",
    "topic": "cmnd/u_03/cmnd/Color"
  },
  {
    "word": "окно",
    "addition": "на кухне",
    "topic": "cmnd/u_04/cmnd/Color"
  },
  {
    "word": "форточка",
    "topic": "cmnd/u_05/cmnd/Color"
  }
]
```
Каждый итем-устройство обязательно содержит **word** - название предмета управления. Одно слово, желательно отвечающее на вопрос _"Что?"_.
Второй обязательный параметр **topic** - топик куда слать данные.

По желанию может быть уточнено местоположение объекта управления в **addition**. Предлог + место. Отвечает на вопрос _"Где?"_.
Во время поиска производится проверка вхождения слов команды во фразу переданной пользователем - как следствие есть проблема с одинаково названными устройствами.
Если есть два окна одно на кухне другое просто окно - то указывать окно на кухне следует первым, в противном случае сработает просто окно так как все слова этой команды найдутся во фразе пользователя раньше чем сравнение дойдет до окна на кухне.

```json
"parameters": [
  {
    "word": "красный",
    "data": "#ff0000"
  },
  {
    "word": "зеленый",
    "data": "#00ff00"
  },
  {
    "word": "синий",
    "data": "#0000ff"
  }
]

"parameters": [
  {
    "ALL": "1"
  }
]
```

Параметры - данные для отправки в топик.

Содержит **"ALL"** - если команда не содержит параметров действия (включить/открыть). Значение **ALL** - данные которые нужно отправить в топик устройства.

ЛИБО

Содержит список из параметров действия. Каждый параметр содержит слово определяющее дополнительные данные для действия.
Где **word** - слово, которое определяет параметр, а **data** - данные, которые нужно отправить в топик устройства.

Пример файла находится в папке **sm_home**. По умолчанию плагин ищет этот файл в этой папке.


[link1]: <https://tasmota.github.io/docs/>